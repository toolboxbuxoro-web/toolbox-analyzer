# Откуда берем данные для анализа "Ниже себестоимости"

## API Endpoint
`GET https://api.moysklad.ru/api/remap/1.2/entity/product`

## Поля из API МойСклад

### Себестоимость (закупочная цена)
**Поля в API:**
- `product.buyPrice` - основное поле (в копейках)
- `product.purchasePrice` - альтернативное поле (если buyPrice нет)

**Валюта себестоимости:**
- `product.buyPriceCurrency` - объект или строка с валютой
  - Если объект: `buyPriceCurrency.code` или `buyPriceCurrency.name`
  - Если строка: прямо код валюты
  - Может быть: `"USD"`, `"840"` (код ISO), `"UZS"` или название валюты

### Цена продажи
**Поля в API:**
- `product.salePrice` - цена продажи (в копейках)

**Валюта цены продажи:**
- `product.salePriceCurrency` - основное поле
- `product.currency` - альтернативное поле (если salePriceCurrency нет)
  - Формат такой же как у buyPriceCurrency

### Информация о товаре
- `product.id` - ID товара
- `product.name` - название товара
- `product.code` - код товара

## Обработка данных

1. **Конвертация из копеек:**
   - `buyPrice / 100` - переводим в основную единицу
   - `salePrice / 100` - переводим в основную единицу

2. **Определение валюты:**
   - Проверяем код валюты: `"USD"`, `"840"` → USD
   - Проверяем название: содержит `"USD"`, `"ДОЛЛАР"`, `"DOLLAR"` → USD
   - Иначе → UZS (по умолчанию)

3. **Конвертация валют:**
   - Если валюта = USD → умножаем на курс: `цена × курс USD→UZS`
   - Если валюта = UZS → оставляем как есть

4. **Сравнение:**
   - Обе цены в UZS
   - Сравниваем: `salePriceUZS < buyPriceUZS`

## Пример данных из API

```json
{
  "id": "123",
  "name": "Товар 1",
  "code": "T001",
  "buyPrice": 100000,  // 1000.00 в основной единице (если UZS)
  "buyPriceCurrency": {
    "code": "USD",
    "name": "Доллар США"
  },
  "salePrice": 120000,  // 1200.00 в основной единице
  "salePriceCurrency": {
    "code": "UZS",
    "name": "Узбекский сум"
  }
}
```

## Важно

- Все цены в API МойСклад хранятся в **копейках** (минимальных единицах)
- Нужно делить на 100 для получения основной единицы
- Валюта может быть объектом или строкой
- По умолчанию валюта = UZS, если не указана
